<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>招聘信息列表</title>
    <script src="/pfo/js/jquery-3.4.1.js"></script>
    <script src="/pfo/js/bootstrap.js"></script>
    <link rel="stylesheet" href="/pfo/css/bootstrap.css">
    <link rel="stylesheet" href="/pfo/css/common/baseTopNavigation.css">
    <link rel="stylesheet" href="/pfo/css/recruit/recruit_list2.css">
    <link rel="stylesheet" href="/pfo/css/jquery.sPage.css" type="text/css">
    <link rel="stylesheet" href="pfo/css/global.css">
    <script src="/pfo/js/jquery.sPage.js"></script>
    <script src="/pfo/js/common/baseTopNavigation.js"></script>
    <script src="/pfo/js/common/baseTopNavigationJS.js"></script>
</head>
<body>

<div class="container">
    <div class="header-wrap d-none d-md-block">
        <div class="module-box">
            <div class="module-head clearfix">
                <h1>招聘信息列表</h1>
                <div class="module-head-oprt">
                    <div class="search-input-wrap focus">
                        <label for="searchByExample" class="ico-search"></label>
                        <input id="searchByExample" type="text" placeholder="请输入公司名称" >&nbsp;
                    </div>
                </div>
            </div>
            <!-- 地点职位筛选条件 -->
            <div class="share-tag-wrap">
                <section>
                    <span class="share-tag-label">地点</span>
                    <div class="share-tag-box">
                        <a href="javascript:void(0);" class="share-tag  selected " onclick="selectByAddress(this)">全国</a>
                        <a href="javascript:void(0);" class="share-tag   " data-val="北京" onclick="selectByAddress(this)">北京</a>
                        <a href="javascript:void(0);" class="share-tag   " data-val="上海" onclick="selectByAddress(this)">上海</a>
                        <a href="javascript:void(0);" class="share-tag   " data-val="广州" onclick="selectByAddress(this)">广州</a>
                        <a href="javascript:void(0);" class="share-tag   " data-val="深圳" onclick="selectByAddress(this)">深圳</a>
                        <a href="javascript:void(0);" class="share-tag   " data-val="杭州" onclick="selectByAddress(this)">杭州</a>
                        <a href="javascript:void(0);" class="share-tag   " data-val="南京" onclick="selectByAddress(this)">南京</a>
                        <a href="javascript:void(0);" class="share-tag   " data-val="成都" onclick="selectByAddress(this)">成都</a>
                        <a href="javascript:void(0);" class="share-tag   " data-val="厦门" onclick="selectByAddress(this)">厦门</a>
                        <a href="javascript:void(0);" class="share-tag   " data-val="武汉" onclick="selectByAddress(this)">武汉</a>
                        <a href="javascript:void(0);" class="share-tag   " data-val="西安" onclick="selectByAddress(this)">西安</a>
                        <a href="javascript:void(0);" class="share-tag   " data-val="长沙" onclick="selectByAddress(this)">长沙</a>
                        <a href="javascript:void(0);" class="share-tag   " data-val="哈尔滨" onclick="selectByAddress(this)">哈尔滨</a>
                        <a href="javascript:void(0);" class="share-tag   " data-val="合肥" onclick="selectByAddress(this)">合肥</a>
                        <a href="javascript:void(0);" class="share-tag   " data-val="其他" onclick="selectByAddress(this)">其他</a>
                    </div>
                </section>
                <section>
                    <span class="share-tag-label">类别</span>
                    <div class="share-tag-box no-border">
                        <a href="javascript:void(0);" class="share-tag  selected " onclick="selectByPosition(this)">全部</a>
                        <a href="javascript:void(0);" class="share-tag    " data-type="1" onclick="selectByPosition(this)">研发</a>
                        <a href="javascript:void(0);" class="share-tag    " data-type="2" onclick="selectByPosition(this)">测试</a>
                        <a href="javascript:void(0);" class="share-tag    " data-type="3" onclick="selectByPosition(this)">数据</a>
                        <a href="javascript:void(0);" class="share-tag    " data-type="4" onclick="selectByPosition(this)">算法</a>
                        <a href="javascript:void(0);" class="share-tag    " data-type="5" onclick="selectByPosition(this)">前端</a>
                        <a href="javascript:void(0);" class="share-tag    " data-type="6" onclick="selectByPosition(this)">产品</a>
                        <a href="javascript:void(0);" class="share-tag    " data-type="7" onclick="selectByPosition(this)">运营</a>
                        <a href="javascript:void(0);" class="share-tag    " data-type="0" onclick="selectByPosition(this)">其他</a>
                    </div>
                </section>
            </div>
            <div class="module-body">
                <div class="career-talk-list">
                </div>
                <div id="myPage" class="Pagination"></div>
            </div>
        </div>
    </div>
</div>

<!-- 模态框（Modal）  公司管理员编辑招聘信息 -->
<div class="modal fade" id="myModal1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <!-- 邮箱 验证码 -->
                <div>
                    <span>编辑招聘消息</span>
                </div>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            </div>
            <!-- 输入招聘信息 -->
            <div class="modal-body" >
                <div>
                    <span>请输入授权码</span>
                    <input id="validCode" type="text" placeholder="请输入授权码">
                    <button id="validConfirm" onclick="confirmValid(this)">确认</button>
                </div>
                <form id="edit-recruitment" class="form-horizontal" style="margin: auto; display: none">
                    <input type="hidden" id="recruitment-id" data-val="">
                    <input type="hidden" id="recruitment-company-id" data-val="">
                    <div class="form-group">
                        <label for="edit-recruitment-title" class="col-sm-4 control-label">招聘标题</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="edit-recruitment-title" placeholder="请输入招聘标题" readonly>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="edit-recruitment-dt" class="col-sm-4 control-label">发布日期</label>
                        <div class="col-sm-10">
                            <input type="datetime" class="form-control" id="edit-recruitment-dt" readonly>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="edit-recruitment-position" class="col-sm-4 control-label">职位</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="edit-recruitment-position" placeholder="请输入招聘标题" readonly>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="edit-recruitment-content" class="col-sm-4 control-label">招聘内容</label>
                        <div class="col-sm-10">
                            <textarea name="recruitmentContent" row="100" class="form-control" id="edit-recruitment-content"></textarea>
                        </div>
                    </div>
                    <!-- 图片 文件上传  可否用拖拽？ -->
                    <div class="form-group">
                        <label for="edit-recruitment-img" class="col-sm-4 control-label">招聘img</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="edit-recruitment-img" placeholder="img">
                            <!--<input type="file" id="add-recruitment-img">-->
                            <!--<p class="help-block">请上传文件</p>-->
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <!-- disabled="disabled" -->
                <button id="add-recruitment" type="button" class="btn btn-primary" onclick="updateRecruitment(this)" >提交</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal -->
</div>
<script>
    /**
     * 修改招聘信息
     * @param obj
     */
    function updateRecruitment(obj){
        var recruitmentId = $("#recruitment-id").attr("data-val");
        var companyId = $("#recruitment-company-id").attr("data-val");
        var recruitmentTitle = $("#edit-recruitment-title").val();
        var deliverTime = $("#edit-recruitment-dt").val();
        var position = $("#edit-recruitment-position").val();
        var recruitmentContent = $("#edit-recruitment-content").val();
        var recruitmentImg = $("#edit-recruitment-img").val();

        $.ajax({
            url: "/pfo/recruitment/updateByPrimaryKey",
            dataType: "json",
            data: {
                "companyId": companyId,
                "recruitmentId": recruitmentId,
                "position": position,
                "recruitmentContent": recruitmentContent,
                "recruitmentImg": recruitmentImg
            },
            method: "post",
            success: function (data) {
                alert("更新成功，刷新页面试试？");
            },
            error: function (xhr) {
                console.warn(xhr);
            }
        })

        alert(position)

        $(obj).attr({
            "data-dismiss": "modal"
        })
    }
</script>
<script src="/pfo/js/common/footer.js"></script>
<link rel="stylesheet" href="/pfo/css/common/footer.css">
<script type="text/javascript">
    $(function () {
        /**
         * 轮播图
         * interval 为每个轮播项之间的切换时间
         * wrap定义是否循环轮播
         */
        $("#carouselMenu").carousel({
            interval: 5000,
            wrap: true
        });
    })
</script>
<script type="text/javascript">
    var n = 0;
    var SortKey = {
        key: '',
        type: ''
    }

    var dataList;

    // 获取地址栏参数
    function getUrlSearch(name) {
        // 为传参，返回空
        if (!name) return null;
        // 查询参数：先通过search取值，如果取不到值就通过hash来获取
        var after = window.location.search;
        after = after.substr(1) || window.location.hash.split('?')[1];
        // 地址栏URL没有查询参数，返回空
        if (!after) return null;
        // 如果查询参数汇总没有"name"，返回空
        if (after.indexOf(name) == -1) return null;

        var reg = new RegExp('(^|&)' + name + '=([^&]*)(&|$)');
        // 当地址栏参数存在中文时，需要解码，不然会乱码
        var r = decodeURI(after).match(reg);
        // 如果url中"name"没有值，返回空
        if (!r) return null;

        return r[2];
    }

    $('#searchByExample').bind('keydown',function (event){
        if(event.keyCode == "13")
        {
            selectByCompanyName(1);
        }
    });

    function selectByCompanyName(currentPage) {
        var companyName = $('#searchByExample').val();

        if (currentPage != null) {
            $.get({
                url: "/pfo/recruitment/queryRecruitmentByCompanyNameWithPage",
                contentType: "application/json;charset=utf-8",
                dataType: "json",
                data: 'currPage=' + currentPage + '&pageSize=6&orderKey=' + SortKey.key + '&orderType=' + SortKey.type + '&companyName=' + companyName,
                success: function (data) {
                    renderRecruitmentByCompanyName(data, currentPage)
                }
            });
        } else {
            currentPage = 1;

            $.get({
                url: "/pfo/recruitment/queryRecruitmentByCompanyNameWithPage",
                contentType: "application/json;charset=utf-8",
                dataType: "json",
                data: 'currPage=' + currentPage + '&pageSize=6&orderKey=' + SortKey.key + '&orderType=' + SortKey.type + '&companyName=' + companyName,
                success: function (data) {
                    renderRecruitmentByCompanyName(data, currentPage)
                }
            });
        }
    }

    function renderRecruitmentByCompanyName(data) {
        var html = '';

        dataList = data.dataList;

        var loginUserId = '';

        $.get({
            url:"/pfo/user/getUser",
            dataType:"json",
            success: function (data2) {
                loginUserId = data2.data.userId;

                console.log("loginUserId : " + loginUserId)

                if (dataList.length == 0) {
                    html += '<div class="career-talk-item js-talk-item">' +
                        '       <h2>oh,还没有招聘信息发布?!</h2>' +
                        '    </div>'
                } else {
                    $.each(dataList, function (i, val) {

                        if (loginUserId == val.pfoCompany.userId) {
                            console.log(i);

                            html += '<div class="career-talk-item js-talk-item">' +
                                '       <a href="recruit_detail.html?recruitmentId=' + val.recruitmentId + '" class="talk-item-btn recruitment-item-select">' +
                                '           <i class="icon-bell-alt"></i>查看详情' +
                                '       </a>' +
                                '       <div class="talk-item-hd">' +
                                '           <span style="font-weight: 900">' + val.recruitmentTitle + '</span>' +
                                '           <span class="sign-new">' + val.position + '</span>' +
                                '       </div>' +
                                '       <div class="talk-item-bd">' +
                                '           <span class="time-item">' + val.deliverTime + '</span>' +
                                '           <span class="college-item">' + val.pfoCompany.companyName + '</span>' +
                                '           <span class="recruitment-item-operator" style="float: right;">' +
                                '               <a  href="#myModal1" data-toggle="modal" id="update-recruitment" onclick="editRecruitment(this)" data="' + dataList[i].recruitmentId + '">' +
                                '                   <i class="icon-bell-alt"></i>编辑' +
                                '               </a>' +
                                '           </span>' +
                                '           <span class="recruitment-item-operator" style="float: right">' +
                                '                <a id="delete-by-id" href="javascript:void(0)" id="item-oper-delete" onclick="deleteRecruitment(this)" data-val="' + val.recruitmentId + '">' +
                                '                    <i class="icon-bell-alt"></i>删除' +
                                '                </a>' +
                                '           </span>' +
                                '       </div>' +
                                '    </div>';
                        } else {
                            console.log(i + ":" + val.pfoCompany.userId);
                            html += '<div class="career-talk-item js-talk-item">' +
                                '       <a href="recruit_detail.html?recruitmentId=' + val.recruitmentId + '" class="talk-item-btn recruitment-item-select">' +
                                '           <i class="icon-bell-alt"></i>查看详情' +
                                '       </a>' +
                                '       <div class="talk-item-hd">' +
                                '           <span style="font-weight: 900">' + val.recruitmentTitle + '</span>' +
                                '           <span class="sign-new">' + val.position + '</span>' +
                                '       </div>' +
                                '       <div class="talk-item-bd">' +
                                '           <span class="time-item">' + val.deliverTime + '</span>' +
                                '           <span class="college-item">' + val.pfoCompany.companyName + '</span>' +
                                '       </div>' +
                                '    </div>';

                        }
                    });
                }


                $(".career-talk-list").html(html);

                // 调用分页插件
                $("#myPage").sPage({
                    page: data.currPage,//当前页码，必填
                    total: data.totalSize,//数据总条数，必填
                    pageSize: data.pageSize,//每页显示多少条数据，默认10条
                    showTotal: true,//是否显示总条数，默认关闭：false
                    totalTxt: "共{total}条",//数据总条数文字描述，{total}为占位符，默认"共{total}条"
                    noData: false,//没有数据时是否显示分页，默认false不显示，true显示第一页
                    showSkip: true,//是否显示跳页，默认关闭：false
                    showPN: true,//是否显示上下翻页，默认开启：true
                    prevPage: "上一页",//上翻页文字描述，默认“上一页”
                    nextPage: "下一页",//下翻页文字描述，默认“下一页”
                    backFun: function (page) {
                        //点击分页按钮回调函数，返回当前页码
                        selectByCompanyName(page)
                    }
                });
            }
        });
    }

    // 修改信息之前验证
    function confirmValid(obj) {
        if ("123" == $("#validCode").val()) {
            $("#edit-recruitment").css("display", "block")
        }
    }

    // companydId 判断是否从公司主页跳转过来
    var companyId = getUrlSearch("companyId")

    if (companyId) {
        console.log("companyId:" + getUrlSearch("companyId"))
        $(document).ready(
            queryRecruitmentByCompanyWithPage(1)
        );
    } else {
        console.log("companyId 为空")
        $(document).ready(
            recruitmentLoad(1)
        );
    }

    // 加载所有招聘信息 关联公司表  含分页
    function recruitmentLoad(currPage) {
        $.ajax({
            url: "/pfo/recruitment/queryRecruitmentsWithPage",
            contentType: "application/json;charset=utf-8",
            dataType: "json",
            data: 'currPage=' + currPage + '&pageSize=6&orderKey=' + SortKey.key + '&orderType=' + SortKey.type,
            success: function (data) {
                console.log(data);
                showRecruitments(data);
                // 调用分页插件
                $("#myPage").sPage({
                    page: data.currPage,//当前页码，必填
                    total: data.totalSize,//数据总条数，必填
                    pageSize: data.pageSize,//每页显示多少条数据，默认10条
                    showTotal: true,//是否显示总条数，默认关闭：false
                    totalTxt: "共{total}条",//数据总条数文字描述，{total}为占位符，默认"共{total}条"
                    noData: false,//没有数据时是否显示分页，默认false不显示，true显示第一页
                    showSkip: true,//是否显示跳页，默认关闭：false
                    showPN: true,//是否显示上下翻页，默认开启：true
                    prevPage: "上一页",//上翻页文字描述，默认“上一页”
                    nextPage: "下一页",//下翻页文字描述，默认“下一页”
                    backFun: function (page) {
                        //点击分页按钮回调函数，返回当前页码
                        recruitmentLoad(page)
                    }
                });
            }
        });
    }

    // 通过公司获取该公司的招聘信息  含分页
    function queryRecruitmentByCompanyWithPage(currPage) {
        $.ajax({
            url: "/pfo/recruitment/queryRecruitmentByCompanyWithPage",
            contentType: "application/json;charset=utf-8",
            dataType: "json",
            data: 'currPage=' + currPage + '&pageSize=6&orderKey=' + SortKey.key + '&orderType=' + SortKey.type + '&companyId=' + companyId,
            success: function (data) {
                showRecruitments(data);
                // 调用分页插件
                $("#myPage").sPage({
                    page: data.currPage,//当前页码，必填
                    total: data.totalSize,//数据总条数，必填
                    pageSize: data.pageSize,//每页显示多少条数据，默认10条
                    showTotal: true,//是否显示总条数，默认关闭：false
                    totalTxt: "共{total}条",//数据总条数文字描述，{total}为占位符，默认"共{total}条"
                    noData: false,//没有数据时是否显示分页，默认false不显示，true显示第一页
                    showSkip: true,//是否显示跳页，默认关闭：false
                    showPN: true,//是否显示上下翻页，默认开启：true
                    prevPage: "上一页",//上翻页文字描述，默认“上一页”
                    nextPage: "下一页",//下翻页文字描述，默认“下一页”
                    backFun: function (page) {
                        //点击分页按钮回调函数，返回当前页码
                        recruitmentLoad(page)
                    }
                });

                var companyName = $("#company_name").text();
            }
        });
    }

    //  渲染数据
    function showRecruitments(data) {
        var html = '';

        dataList = data.dataList;

        var loginUserId = '';

        $.get({
            url:"/pfo/user/getUser",
            dataType:"json",
            success: function (data2) {
                loginUserId = data2.data.userId;

                console.log("loginUserId : " + loginUserId)

                if (dataList.length == 0) {
                    html += '<div class="career-talk-item js-talk-item">' +
                        '       <h2>oh,还没有招聘信息发布?!</h2>' +
                        '    </div>'
                } else {
                    $.each(dataList, function (i, val) {

                        if (loginUserId == val.pfoCompany.userId) {
                            console.log(i);

                            html += '<div class="career-talk-item js-talk-item">' +
                                '       <a href="recruit_detail.html?recruitmentId=' + val.recruitmentId + '" class="talk-item-btn recruitment-item-select">' +
                                '           <i class="icon-bell-alt"></i>查看详情' +
                                '       </a>' +
                                '       <div class="talk-item-hd">' +
                                '           <span style="font-weight: 900">' + val.recruitmentTitle + '</span>' +
                                '           <span class="sign-new">' + val.position + '</span>' +
                                '       </div>' +
                                '       <div class="talk-item-bd">' +
                                '           <span class="time-item">' + val.deliverTime + '</span>' +
                                '           <span class="college-item">' + val.pfoCompany.companyName + '</span>' +
                                '           <span class="recruitment-item-operator" style="float: right;">' +
                                '               <a  href="#myModal1" data-toggle="modal" id="update-recruitment" onclick="editRecruitment(this)" data="' + dataList[i].recruitmentId + '">' +
                                '                   <i class="icon-bell-alt"></i>编辑' +
                                '               </a>' +
                                '           </span>' +
                                '           <span class="recruitment-item-operator" style="float: right">' +
                                '                <a id="delete-by-id" href="javascript:void(0)" id="item-oper-delete" onclick="deleteRecruitment(this)" data-val="' + val.recruitmentId + '">' +
                                '                    <i class="icon-bell-alt"></i>删除' +
                                '                </a>' +
                                '           </span>' +
                                '       </div>' +
                                '    </div>';
                        } else {
                            console.log(i + ":" + val.pfoCompany.userId);
                            html += '<div class="career-talk-item js-talk-item">' +
                                '       <a href="recruit_detail.html?recruitmentId=' + val.recruitmentId + '" class="talk-item-btn recruitment-item-select">' +
                                '           <i class="icon-bell-alt"></i>查看详情' +
                                '       </a>' +
                                '       <div class="talk-item-hd">' +
                                '           <span style="font-weight: 900">' + val.recruitmentTitle + '</span>' +
                                '           <span class="sign-new">' + val.position + '</span>' +
                                '       </div>' +
                                '       <div class="talk-item-bd">' +
                                '           <span class="time-item">' + val.deliverTime + '</span>' +
                                '           <span class="college-item">' + val.pfoCompany.companyName + '</span>' +
                                '       </div>' +
                                '    </div>';

                        }
                    });
                }


                $(".career-talk-list").html(html);
            }
        });


    }

    // 编辑招聘信息
    function editRecruitment(obj) {
        var id = $(obj).attr("data");

        $.ajax({
            url: "/pfo/recruitment/queryByRecruitmentId",
            dataTyp: "json",
            data: "recruitmentId=" + id,
            success: function (data) {
                console.log(data);
                var recruit = data.data;
                $("#recruitment-id").attr(
                    "data-val", id
                );
                $("#recruitment-company-id").attr(
                    "data-val", recruit.companyId
                );
                $("#edit-recruitment-title").val("招聘信息" + recruit.companyId);
                $("#edit-recruitment-dt").val(recruit.deliverTime);
                $("#edit-recruitment-position").val(recruit.position);
                $("#edit-recruitment-content").val(recruit.recruitmentContent);
                $("#edit-recruitment-img").val(recruit.recruitmentImg)
            }
        })
    }

    // 删除招聘信息
    function deleteRecruitment(obj) {
        var id = $(obj).attr("data-val")
        alert("确定删除吗？ value.recruitmentId: " + id);
        $.ajax({
            url: "/pfo/recruitment/deleteByPrimaryKey",
            data: "recruitmentId=" + id,
            success: function (data) {
                alert("删除成功")
            },
            error: function (xhr) {
                console.warn(xhr);
            }
        })
    }

    /**
     * 地点条件查询  还有缺陷  待优化
     * @param obj
     */
    function selectByAddress(obj) {
        var $ele = $(obj);
        var address = $ele.text().trim();
        var html = '';

        var loginUserId = '';

        $.get({
            url: "/pfo/user/getUser",
            dataType: "json",
            success: function (data2) {
                loginUserId = data2.data.userId;

                console.log("loginUserId : " + loginUserId);

                // 遍历地点
                $.each(dataList, function (i, value) {
                    if (loginUserId == value.pfoCompany.userId) {
                        if ('全国' != address) {
                            if (address == value.pfoCompany.companyAddress) {
                                html += '<div class="career-talk-item js-talk-item">' +
                                    '       <a href="recruit_detail.html?recruitmentId=' + value.recruitmentId + '" class="talk-item-btn nc-req-auth js-subscribe">' +
                                    '           <i class="icon-bell-alt"></i>查看详情' +
                                    '       </a>' +
                                    '       <div class="talk-item-hd">' +
                                    '           <span>' + value.recruitmentTitle + '</span>' +
                                    '           <span class="sign-new">' + value.position + '</span>' +
                                    '       </div>' +
                                    '       <div class="talk-item-bd">' +
                                    '           <span class="time-item">' + value.deliverTime + '</span>' +
                                    '           <span class="college-item">' + value.pfoCompany.companyName + '</span>' +
                                    '           <span id="item-oper-edit" style="float: right;">' +
                                    '               <a href="javascript:void(0)" class="recruitment-item-operator">' +
                                    '                   <i class="icon-bell-alt"></i>编辑' +
                                    '               </a>' +
                                    '           </span>' +
                                    '           <span id="item-oper-delete" style="float: right">' +
                                    '                <a href="javascript:void(0)" class="recruitment-item-operator">' +
                                    '                    <i class="icon-bell-alt"></i>删除' +
                                    '                </a>' +
                                    '           </span>' +
                                    '       </div>' +
                                    '   </div>';
                            }
                        } else {
                            html += '<div class="career-talk-item js-talk-item">' +
                                '       <a href="recruit_detail.html?recruitmentId=' + value.recruitmentId + '" class="talk-item-btn nc-req-auth js-subscribe">' +
                                '           <i class="icon-bell-alt"></i>查看详情' +
                                '       </a>' +
                                '       <div class="talk-item-hd">' +
                                '           <span>' + value.recruitmentTitle + '</span>' +
                                '           <span class="sign-new">' + value.position + '</span>' +
                                '       </div>' +
                                '       <div class="talk-item-bd">' +
                                '           <span class="time-item">' + value.deliverTime + '</span>' +
                                '           <span class="college-item">' + value.pfoCompany.companyName + '</span>' +
                                '           <span id="item-oper-edit" style="float: right;">' +
                                '               <a href="javascript:void(0)" class="recruitment-item-operator">' +
                                '                   <i class="icon-bell-alt"></i>编辑' +
                                '               </a>' +
                                '           </span>' +
                                '           <span id="item-oper-delete" style="float: right">' +
                                '                <a href="javascript:void(0)" class="recruitment-item-operator">' +
                                '                    <i class="icon-bell-alt"></i>删除' +
                                '                </a>' +
                                '           </span>' +
                                '       </div>' +
                                '   </div>';
                        }
                    } else {
                        if ('全国' != address) {
                            if (address == value.pfoCompany.companyAddress) {
                                html += '<div class="career-talk-item js-talk-item">' +
                                    '       <a href="recruit_detail.html?recruitmentId=' + value.recruitmentId + '" class="talk-item-btn nc-req-auth js-subscribe">' +
                                    '           <i class="icon-bell-alt"></i>查看详情' +
                                    '       </a>' +
                                    '       <div class="talk-item-hd">' +
                                    '           <span>' + value.recruitmentTitle + '</span>' +
                                    '           <span class="sign-new">' + value.position + '</span>' +
                                    '       </div>' +
                                    '       <div class="talk-item-bd">' +
                                    '           <span class="time-item">' + value.deliverTime + '</span>' +
                                    '           <span class="college-item">' + value.pfoCompany.companyName + '</span>' +
                                    '       </div>' +
                                    '   </div>';
                            }
                        } else {
                            html += '<div class="career-talk-item js-talk-item">' +
                                '       <a href="recruit_detail.html?recruitmentId=' + value.recruitmentId + '" class="talk-item-btn nc-req-auth js-subscribe">' +
                                '           <i class="icon-bell-alt"></i>查看详情' +
                                '       </a>' +
                                '       <div class="talk-item-hd">' +
                                '           <span>' + value.recruitmentTitle + '</span>' +
                                '           <span class="sign-new">' + value.position + '</span>' +
                                '       </div>' +
                                '       <div class="talk-item-bd">' +
                                '           <span class="time-item">' + value.deliverTime + '</span>' +
                                '           <span class="college-item">' + value.pfoCompany.companyName + '</span>' +
                                '           <span id="item-oper-edit" style="float: right;">' +
                                '       </div>' +
                                '   </div>';
                        }
                    }
                })

                console.log(dataList);
                $(".career-talk-list").html(html);
            }
        })
    }

    // 职位条件查询 还有缺陷 待优化
    function selectByPosition(obj) {
        var $ele = $(obj);
        var position = $ele.text().trim();
        var html = '';

        var loginUserId = '';

        $.get({
            url: "/pfo/user/getUser",
            dataType: "json",
            success: function (data2) {
                loginUserId = data2.data.userId;

                console.log("loginUserId : " + loginUserId);

                recruitmentsWithPage(1, position, loginUserId);

                console.log(dataList);


            }
        })


    }

    // 加载所有招聘信息 关联公司表  含分页
    function recruitmentsWithPage(currPage, position, loginUserId) {
        var html = '';

        $.ajax({
            url: "/pfo/recruitment/queryRecruitmentsWithPage",
            contentType: "application/json;charset=utf-8",
            dataType: "json",
            data: 'currPage=' + currPage + '&pageSize=6&orderKey=' + SortKey.key + '&orderType=' + SortKey.type + "&position=" + position,
            success: function (data) {
                console.log(data);

                var dataList = data.dataList;
                /**
                 * 遍历职位
                 */
                $.each(dataList, function (i, value) {
                    if (loginUserId == value.pfoCompany.userId) {

                        if (position != '全部') {
                            if (position == value.position) {
                                html += '<div class="career-talk-item js-talk-item">' +
                                    '       <a href="recruit_detail.html?recruitmentId=' + value.recruitmentId + '" class="talk-item-btn nc-req-auth js-subscribe">' +
                                    '           <i class="icon-bell-alt"></i>查看详情' +
                                    '       </a>' +
                                    '       <div class="talk-item-hd">' +
                                    '           <span>' + value.recruitmentTitle + '</span>' +
                                    '           <span class="sign-new">' + value.position + '</span>' +
                                    '       </div>' +
                                    '       <div class="talk-item-bd">' +
                                    '           <span class="time-item">' + value.deliverTime + '</span>' +
                                    '           <span class="college-item">' + value.pfoCompany.companyName + '</span>' +
                                    '           <span id="item-oper-edit" style="float: right;">' +
                                    '               <a href="javascript:void(0)" class="recruitment-item-operator">' +
                                    '                   <i class="icon-bell-alt"></i>编辑' +
                                    '               </a>' +
                                    '           </span>' +
                                    '           <span id="item-oper-delete" style="float: right">' +
                                    '                <a href="javascript:void(0)" class="recruitment-item-operator">' +
                                    '                    <i class="icon-bell-alt"></i>删除' +
                                    '                </a>' +
                                    '           </span>' +
                                    '       </div>' +
                                    '   </div>';
                            }
                        } else {
                            alert("全部");
                            html += '<div class="career-talk-item js-talk-item">' +
                                '       <a href="recruit_detail.html?recruitmentId=' + value.recruitmentId + '" class="talk-item-btn nc-req-auth js-subscribe">' +
                                '           <i class="icon-bell-alt"></i>查看详情' +
                                '       </a>' +
                                '       <div class="talk-item-hd">' +
                                '           <span>' + value.recruitmentTitle + '</span>' +
                                '           <span class="sign-new">' + value.position + '</span>' +
                                '       </div>' +
                                '       <div class="talk-item-bd">' +
                                '           <span class="time-item">' + value.deliverTime + '</span>' +
                                '           <span class="college-item">' + value.pfoCompany.companyName + '</span>' +
                                '           <span id="item-oper-edit" style="float: right;">' +
                                '               <a href="javascript:void(0)" class="recruitment-item-operator">' +
                                '                   <i class="icon-bell-alt"></i>编辑' +
                                '               </a>' +
                                '           </span>' +
                                '           <span id="item-oper-delete" style="float: right">' +
                                '                <a href="javascript:void(0)" class="recruitment-item-operator">' +
                                '                    <i class="icon-bell-alt"></i>删除' +
                                '                </a>' +
                                '           </span>' +
                                '       </div>' +
                                '   </div>';
                        }
                    } else {
                        if (position != '全部') {
                            if (position == value.position) {
                                html += '<div class="career-talk-item js-talk-item">' +
                                    '       <a href="recruit_detail.html?recruitmentId=' + value.recruitmentId + '" class="talk-item-btn nc-req-auth js-subscribe">' +
                                    '           <i class="icon-bell-alt"></i>查看详情' +
                                    '       </a>' +
                                    '       <div class="talk-item-hd">' +
                                    '           <span>' + value.recruitmentTitle + '</span>' +
                                    '           <span class="sign-new">' + value.position + '</span>' +
                                    '       </div>' +
                                    '       <div class="talk-item-bd">' +
                                    '           <span class="time-item">' + value.deliverTime + '</span>' +
                                    '           <span class="college-item">' + value.pfoCompany.companyName + '</span>' +
                                    '       </div>' +
                                    '   </div>';
                            }
                        } else {
                            alert("全部");
                            html += '<div class="career-talk-item js-talk-item">' +
                                '       <a href="recruit_detail.html?recruitmentId=' + value.recruitmentId + '" class="talk-item-btn nc-req-auth js-subscribe">' +
                                '           <i class="icon-bell-alt"></i>查看详情' +
                                '       </a>' +
                                '       <div class="talk-item-hd">' +
                                '           <span>' + value.recruitmentTitle + '</span>' +
                                '           <span class="sign-new">' + value.position + '</span>' +
                                '       </div>' +
                                '       <div class="talk-item-bd">' +
                                '           <span class="time-item">' + value.deliverTime + '</span>' +
                                '           <span class="college-item">' + value.pfoCompany.companyName + '</span>' +
                                '       </div>' +
                                '   </div>';
                        }

                    }

                })

                $(".career-talk-list").html(html);
                // 调用分页插件
                $("#myPage").sPage({
                    page: data.currPage,//当前页码，必填
                    total: data.totalSize,//数据总条数，必填
                    pageSize: data.pageSize,//每页显示多少条数据，默认10条
                    showTotal: true,//是否显示总条数，默认关闭：false
                    totalTxt: "共{total}条",//数据总条数文字描述，{total}为占位符，默认"共{total}条"
                    noData: false,//没有数据时是否显示分页，默认false不显示，true显示第一页
                    showSkip: true,//是否显示跳页，默认关闭：false
                    showPN: true,//是否显示上下翻页，默认开启：true
                    prevPage: "上一页",//上翻页文字描述，默认“上一页”
                    nextPage: "下一页",//下翻页文字描述，默认“下一页”
                    backFun: function (page) {
                        //点击分页按钮回调函数，返回当前页码
                        recruitmentsWithPage(page, position, loginUserId)
                    }
                });
            }
        });
    }



    // /**
    //  * 最新   按时间降序排序
    //  * @param obj
    //  */
    // function orderBydeliverTime(obj) {
    //     $.get({
    //         url: "/pfo/recruitment/queryRecruitmentOrderByDeliverTime",
    //         dataType: "json",
    //         success: function (data) {
    //             console.log(data);
    //         }
    //     })
    // }

</script>
</body>
</html>